<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Results – {{ brand }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
<div class="container my-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h2 class="mb-0"><i class="bi bi-list-check"></i> Search results</h2>
    <a class="btn btn-outline-secondary" href="{{ url_for('index') }}"><i class="bi bi-arrow-left"></i> Back</a>
  </div>

  {% if results and results|length > 0 %}
    <p class="text-muted">Showing {{ (page-1)*per_page + 1 }}–{{ (page-1)*per_page + results|length }} of {{ total }} results</p>

    <div class="row g-3">
      {% for r in results %}
      <div class="col-12 col-md-6 col-xl-4">
        <div class="flight-card p-3 h-100 d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div class="route">{{ r.route }}</div>
            <div class="airline-pill">Ryanair</div>
          </div>

          <div class="mb-2">
            <div><i class="bi bi-arrow-right-circle"></i> <strong>{{ r.out_date }}</strong> <span class="date-chip">{{ r.out_date|weekday_name }}</span></div>
            {% if not one_way %}
            <div class="mt-1"><i class="bi bi-arrow-left-circle"></i> <strong>{{ r.in_date }}</strong> <span class="date-chip">{{ r.in_date|weekday_name }}</span></div>
            {% endif %}
          </div>

          <div class="mt-auto d-flex justify-content-between align-items-end">
            <div class="price-badge">{{ r.price }} <small class="text-muted">{{ r.currency }}</small></div>
            <a class="btn btn-open" href="{{ r.link }}" target="_blank" rel="noopener">
              <i class="bi bi-box-arrow-up-right"></i> Open
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Pagination keeps state -->
    <div class="d-flex justify-content-between align-items-center mt-4">
      <form method="post" class="mb-0">
        {% for d in form_payload.departures %}<input type="hidden" name="departures" value="{{ d }}">{% endfor %}
        {% if form_payload.departure_country %}<input type="hidden" name="departure_country" value="{{ form_payload.departure_country }}">{% endif %}
        {% for c in form_payload.arrival_countries %}<input type="hidden" name="arrival_countries" value="{{ c }}">{% endfor %}
        <input type="hidden" name="arrival" value="{{ form_payload.arrival }}">
        <input type="hidden" name="date_from" value="{{ form_payload.date_from }}">
        <input type="hidden" name="date_to" value="{{ form_payload.date_to }}">
        <input type="hidden" name="currency" value="{{ form_payload.currency }}">
        <input type="hidden" name="max_price" value="{{ form_payload.max_price }}">
        {% if form_payload.one_way_only %}<input type="hidden" name="one_way_only" value="on">{% endif %}
        <input type="hidden" name="min_stay" value="{{ form_payload.min_stay }}">
        <input type="hidden" name="max_stay" value="{{ form_payload.max_stay }}">
        <input type="hidden" name="out_weekday" value="{{ form_payload.out_weekday }}">
        <input type="hidden" name="page" value="{{ page - 1 }}">
        <button class="btn btn-outline-primary" {% if page <= 1 %}disabled{% endif %}>
          <i class="bi bi-chevron-left"></i> Prev
        </button>
      </form>

      <span class="text-muted">Page {{ page }} of {{ total_pages }}</span>

      <form method="post" class="mb-0">
        {% for d in form_payload.departures %}<input type="hidden" name="departures" value="{{ d }}">{% endfor %}
        {% if form_payload.departure_country %}<input type="hidden" name="departure_country" value="{{ form_payload.departure_country }}">{% endif %}
        {% for c in form_payload.arrival_countries %}<input type="hidden" name="arrival_countries" value="{{ c }}">{% endfor %}
        <input type="hidden" name="arrival" value="{{ form_payload.arrival }}">
        <input type="hidden" name="date_from" value="{{ form_payload.date_from }}">
        <input type="hidden" name="date_to" value="{{ form_payload.date_to }}">
        <input type="hidden" name="currency" value="{{ form_payload.currency }}">
        <input type="hidden" name="max_price" value="{{ form_payload.max_price }}">
        {% if form_payload.one_way_only %}<input type="hidden" name="one_way_only" value="on">{% endif %}
        <input type="hidden" name="min_stay" value="{{ form_payload.min_stay }}">
        <input type="hidden" name="max_stay" value="{{ form_payload.max_stay }}">
        <input type="hidden" name="out_weekday" value="{{ form_payload.out_weekday }}">
        <input type="hidden" name="page" value="{{ page + 1 }}">
        <button class="btn btn-outline-primary" {% if page >= total_pages %}disabled{% endif %}>
          Next <i class="bi bi-chevron-right"></i>
        </button>
      </form>
    </div>

  {% else %}
    <div class="alert alert-warning"><i class="bi bi-emoji-frown"></i> No flights matched your filters.</div>
  {% endif %}
</div>

<footer class="py-4 text-center small">
  <div class="d-flex gap-2 justify-content-center flex-wrap">
    <a class="btn btn-sm btn-outline-primary" href="https://www.linkedin.com/in/maciej-kasperczyk-b425321a9/" target="_blank" rel="noopener">
      <i class="bi bi-linkedin"></i> LinkedIn
    </a>
    <a class="btn btn-sm btn-outline-dark" href="mailto:maciej.kasperczyk.scriptify365@gmail.com">
      <i class="bi bi-envelope"></i> maciej.kasperczyk.scriptify365@gmail.com
    </a>
  </div>
  <div class="text-muted mt-2">© {{ brand }} by Maciej Kasperczyk</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
